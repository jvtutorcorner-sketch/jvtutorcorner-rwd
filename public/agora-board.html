<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agora Fastboard Static</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@netless/window-manager/dist/style.css">
    <style>
        html, body, #fastboard-app { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@netless/fastboard/dist/index.iife.js"></script>
</head>
<body>
    <div id="fastboard-app"></div>

    <script>
        // 解析 URL 參數
        const params = new URLSearchParams(window.location.search);
        const appIdentifier = params.get('appId');
        const roomUuid = params.get('uuid');
        const roomToken = params.get('token');
        const userId = params.get('uid');
        const region = params.get('region') || 'sg'; // 預設 sg

        async function init() {
            if (!appIdentifier || !roomUuid || !roomToken) {
                document.body.innerHTML = '<h3 style="color:red">缺少參數 (appId, uuid, token)</h3>';
                return;
            }

            try {
                // 3. 使用全域變數 Fastboard
                const fastboard = await Fastboard.createFastboard({
                    sdkConfig: {
                        appIdentifier: appIdentifier,
                        region: region,
                    },
                    joinRoom: {
                        uid: userId,
                        uuid: roomUuid,
                        roomToken: roomToken,
                        isWritable: true,
                    },
                });

                // 4. 掛載
                await fastboard.mount(document.getElementById('fastboard-app'));
                console.log("Fastboard Mounted Successfully!");

                // 5. 設定工具 (可選)
                setTimeout(() => {
                    fastboard.setAppliance('pencil');
                    fastboard.setStrokeColor([220, 38, 38]);
                    fastboard.setStrokeWidth(4);
                }, 1000);

            } catch (error) {
                console.error(error);
                document.body.innerHTML = `<h3 style="color:red">Error: ${error.message}</h3>`;
            }
        }

        init();
    </script>
</body>
</html>