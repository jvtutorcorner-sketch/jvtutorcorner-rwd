# 更新記錄

## 2024-12-24 更新

### 1. Teacher Orders 頁面改進 (`/teacher_courses`)
- **課程名稱顯示**：將原本顯示的課程ID改為顯示課程名稱
- **實現方式**：
  - 訂單載入後，並行抓取所有課程ID的課程資訊
  - 建立 courseId → title 映射表
  - 表格顯示課程名稱（找不到時回退顯示ID）

**修改檔案**：
- `app/teacher_courses/page.tsx`

### 2. 等待室音視頻檢測功能 (`/classroom/wait`)
參考 Google Meet 體驗，實現強制音視頻檢測流程：

#### 主要功能
1. **強制設備檢測**：所有用戶（老師和學生）加入教室前必須完成音視頻檢測
2. **設備測試UI**：
   - 🎤 麥克風測試：顯示即時音量條，測試麥克風是否正常
   - 📹 攝影機預覽：16:9 視頻預覽窗口，確認攝影機畫面
   - 設備選擇：支援選擇不同的麥克風和攝影機
   - 權限請求：一鍵授予音視頻權限
3. **就緒狀態管理**：
   - ✓ 只有通過音視頻檢測才能標記為就緒
   - 即時同步：使用 SSE + localStorage + BroadcastChannel 三重同步
   - 雙方確認：顯示老師和學生的就緒狀態
4. **自動進入**：老師和學生都就緒後，1秒後自動進入教室

#### UI 改進
- 清晰的步驟指引和狀態提示
- Google Meet 風格的現代化界面
- 視覺化的檢測狀態（✓ 標記、顏色編碼）
- 友好的錯誤提示和操作指引

**修改檔案**：
- `app/classroom/wait/page.tsx`（完全重寫）
- `app/classroom/wait/page.tsx.backup`（備份原文件）

#### 技術特點
- 響應式布局，支援桌面和平板
- 自動記住用戶的設備選擇偏好
- 跨標籤頁/視窗即時同步就緒狀態
- 完整的錯誤處理和用戶提示

## 測試確認
- ✅ `/teacher_courses` 正確顯示課程名稱
- ✅ 等待室音視頻檢測UI正常渲染
- ✅ 麥克風測試和音量顯示正常
- ✅ 攝影機預覽功能正常
- ✅ 雙方就緒狀態即時同步
- ✅ 自動進入教室功能正常

## 使用說明

### Teacher Orders 頁面
1. 以老師身份登入
2. 前往 `/teacher_courses`
3. 查看訂單列表，課程欄位顯示課程名稱而非ID

### 等待室檢測流程
1. 訪問 `/classroom/wait?courseId=xxx&orderId=xxx`
2. **步驟1**：授予麥克風和攝影機權限
3. **步驟2**：點擊"測試麥克風"按鈕，確認能看到音量條跳動
4. **步驟3**：點擊"預覽攝影機"按鈕，確認能看到攝影機畫面
5. **步驟4**：完成檢測後，點擊"點擊表示準備好"
6. **步驟5**：等待另一方（老師/學生）也完成檢測並就緒
7. **自動進入**：雙方就緒後自動進入教室

## 備註
- 等待室原版本已備份至 `app/classroom/wait/page.tsx.backup`
- 設備偏好會保存在 localStorage，下次訪問自動套用
- 支援多標籤頁即時同步（使用 BroadcastChannel）
